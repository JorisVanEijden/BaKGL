#pragma once

#include "dialogTarget.hpp"

#include "xbak/FileBuffer.h"

#include <glm/glm.hpp>


/* DEF_ZONE.DAT
2700 0000 
0127 000a 0b0a 1127 0040 f732 2900 0000 0000 0000
0127 0001 0a0d 0911 00c0 fe32 2900 0000 0000 0000
0127 0002 0a12 031e 00a0 e132 2900 0000 0000 0000
0107 0005 0a0b 0c0d 00c0 e332 2900 0000 0000 0000
0107 0001 0f11 2214 0060 ec32 2900 0000 0000 0000
0008 0006 0b0a 1503 0000 e432 2900 0000 0000 0000
0100 010c 0b0e 120c 0000 1833 2900 0000 0000 0000
0127 0002 0f12 1c25 0080 e232 2900 0000 0000 0000
0127 0001 0f0a 2213 0020 e632 2900 0000 0000 0000
0127 0001 0a0b 1b02 0020 e532 2900 0000 0000 0000
0127 0003 0a0a 0411 00c0 e732 2900 0000 0000 0000
0127 0002 130a 230e 0040 e832 2900 0000 0000 0000
00fe 030a 0a10 1026 0080 f832 2900 0000 0000 0000
0127 0004 0e0a 1a04 0000 e932 2900 0000 0000 0000
0127 0003 1712 1325 0080 ea32 2900 0000 0000 0000
0107 0005 1710 1302 0000 eb32 2900 0000 0000 0000
0107 0004 0a14 0925 0080 ed32 2900 0000 0000 0000
0110 0006 150f 2517 0060 ee32 2900 0000 0000 0000
0110 0005 1612 0924 00a0 f232 2900 0000 0000 0000
0117 000c 0d0f 1801 0000 f932 2900 0000 0000 0000
0107 0007 0d0f 1423 0060 f032 2900 0000 0000 0000
0107 0005 0f0a 1902 0000 f432 2900 0000 0000 0000
0008 0006 110c 1b07 0000 ef32 2900 0000 0000 0000
0100 010a 0d0e 1607 0080 1933 2900 0000 0000 0000
0009 0005 0f0e 0d25 0060 f332 2900 0000 0000 0000
0120 000a 0a0e 0416 00c0 fb32 2900 0000 0000 0000
0120 0008 0f0a 1e0e 0040 ff32 2900 0000 0000 0000
0126 000a 0b0e 2514 0040 0033 2900 0000 0000 0000
0126 000a 0a0a 161b 00c0 0133 2900 0000 0000 0000
00ff 0302 1111 191e 0080 0233 2900 0000 0000 0000
0180 0009 0d0c 091d 00c0 0333 2900 0000 0000 0000
0180 000a 0e0a 0717 0000 fd32 2900 0000 0000 0000
0120 000b 0b0d 0a19 0000 0633 2900 0000 0000 0000
0120 000b 0a0a 1e21 0000 0733 2900 0000 0000 0000
0108 000c 0a10 2606 0000 0833 2900 0000 0000 0000
0108 000c 0b0b 0e09 0000 0933 2900 0000 0000 0000
0120 000c 0d0d 1c01 0000 24fe 1c00 0000 0000 0000
0120 0008 0a0d 1116 0080 0a33 2900 0000 0000 0000
0117 0005 1610 111e 0080 0b33 2900 0000 0000 0000 
*/

namespace BAK {

struct Zone
{
    std::uint32_t mZoneTag;
    KeyTarget mDialog;
};

std::vector<Zone> LoadZones()
{
    std::vector<Zone> zones;

    auto fb = FileBufferFactory::CreateFileBuffer("DEF_ZONE.DAT");

    const unsigned nZones = fb.GetUint16LE();
	fb.DumpAndSkip(2);

    for (unsigned i = 0; i < nZones; i++)
    {
        const unsigned tag = fb.GetUint16LE();
        fb.DumpAndSkip(8);
        const auto dialog = KeyTarget{fb.GetUint32LE()};
		fb.DumpAndSkip(6);

        zones.emplace_back(
            tag,
            dialog);
    }

    return zones;
}

}
